#include "MAX7219.h"

/////////////////////////////////////////////////////////////////////
// подключение:
//	пин PA5 CLK 	режим просто OUTPUT
//	пин PA6 CS		режим просто OUTPUT
//	пин PA7 DIN		режим просто OUTPUT
//////////////////////////////////////////////////////////////////////

//-----------------------------------------
void main(){

	// Инициализация матрицы
	 MAX_init();
	
	extern int32_t x;
	extern int32_t y;
	extern uint8_t *frameBuffer;

	// выделение динамической памяти для массива
	frameBuffer = (uint8_t *)malloc(sizeof(MATRIXS_QUANTITY*8));
	
	// Создаем строку для отображения функция utf8rus() выделит динамическую память под
	// нужный размер и вернет на нее указатель
	// в начале и в конце не забываем ставить пробелы для красивого отображения текста
	char *myText = utf8rus( " Ё ё Hello NEW Привет ВАСЯ 1983 " );
	// незабываем каждый раз после вызова функции utf8rus() освобождать память
	free( pText );	// освобождаем память выделенную в функции utf8rus() посредством malloc();

	// ТОЛЬКО для отображения анимации------------------------------------------------------
	//x = ( 8*MATRIXS_QUANTITY );	// ставим для движения анимации с права на лево
	//x = 0; // для движения анимации с лево на право
	//---------------------------------------------------------------------------------------
	
	
	//-------------------------------------------------
	while(1){
	
		// ВЫВОДИМ БЕГУЩУЮ СТРОКУ	/////////////////////////////////////////
		//---------------------------------------------
		
		int len = strlen( myText );			// Узнаем длину нашего текста
		drawString( myText, len, x, 0 );	// выводим на экран наш текст
					  
		display();	// отображаем на дисплее то что нарисовали выше
		HAL_Delay(100);

		if( --x < len * -8 ) {
			x = (MATRIXS_QUANTITY*8);
		}
		//---------------------------------------------
		//////////////////////////////////////////////////////////////////////
		
		// ВІВОДИМ АНИМАЦИЮ		//////////////////////////////////////////////
		//-------------------------------------------------------------------
		
		clear();
		drawSprite( (uint8_t*)&a, x--, 0, 8, 8 ); // Х-- ставим для движения анимации с права на лево, Х++ для движения анимации с лево на право
		display();	// отображаем на дисплее то что нарисовали выше
		HAL_Delay(200);

		clear();
		drawSprite( (uint8_t*)&b, x--, 0, 8, 8 );	// Х-- ставим для движения анимации с права на лево, Х++ для движения анимации с лево на право
		display();	// отображаем на дисплее то что нарисовали выше
		HAL_Delay(200);
		
		// ВНИМАНИЕ ВІВОДИМ СТОЛЬКО КАДРОВ СКОЛЬКО ЕСТЬ ( в данном случае ДВА кадра )
				
				//-- для движения анимации с лево на право -----------
				//	if( x > ( 8*MATRIXS_QUANTITY ) ){
				//		x= -1;
				//	}
				//-----------------------------------------------------------

				//-----------------------------------------------------------	  
				//-- для движения анимации с права на лево -------------
				if( x <-6){
					x= ( 8*MATRIXS_QUANTITY );
				}
				
		///////////////////////////////////////////////////////////////////////
	}

}